<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Menu Natal Especial</title>
<style>
  :root{
    --bg:#faf6f0; --header1:#b30000; --header2:#700000; --accent:#c41e3a; --text:#333;
  }
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  body{background:var(--bg);padding:18px;box-sizing:border-box;color:var(--text)}
  .wrap{max-width:900px;margin:0 auto}
  header{display:flex;flex-direction:column;align-items:center;gap:12px;margin-bottom:18px}
  h1{font-family: "Georgia", serif;font-size:44px;margin:0;color:white;padding:16px 28px;border-radius:12px;
      background:linear-gradient(135deg,var(--header1),var(--header2));box-shadow:0 4px 10px rgba(0,0,0,0.18);text-align: center !important;width: 100% !important;line-height: 1.2}
  .catalog-btn{background:var(--header1);color:#fff;padding:12px 18px;border-radius:10px;text-decoration:none;display:inline-block}
  #products{display:flex;flex-direction:column;gap:18px;margin:18px 0}
  .product{display:flex;align-items:center;background:#fff;border-radius:16px;padding:12px;box-shadow:0 6px 14px rgba(0,0,0,0.08);gap:12px}
  .product img{width:110px;height:110px;object-fit:cover;border-radius:12px;border:3px solid var(--accent);flex:0 0 110px}
  .info{flex:1}
  .info strong{display:block;font-size:16px;color:var(--header2)}
  .price{font-weight:700;margin-top:4px}
  .qty{width:55px;height:48px;font-size:18px;padding:4px;border-radius:10px;border:2px solid var(--accent);text-align:center}
  .summary{margin-top:22px;background:#fff;padding:18px;border-radius:12px;box-shadow:0 6px 14px rgba(0,0,0,0.08)}
  label{display:block;margin-bottom:8px;font-weight:600}
  input[type=text],input[type=email]{width:100%;padding:10px;border-radius:8px;border:1px solid #ddd;font-size:18px}
  .total{font-size:20px;font-weight:800;color:var(--header2);margin-top:8px}
  .btn{background:var(--header1);color:#fff;border:none;padding:12px 18px;border-radius:10px;font-size:18px;cursor:pointer}
  .status{margin-top:12px;padding:10px;border-radius:8px;display:none}
  .status.ok{background:#e8ffe8;color:#0a7a0a;border:1px solid #3bb33b;display:block}
  .status.err{background:#ffe8e8;color:#7a0a0a;border:1px solid #b33b3b;display:block}
  /* small screens */
  @media(max-width:600px){
    .product{flex-direction:row;gap:12px}
    .info strong{font-size:18px}
    .price{font-size:16px}
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Menu Natal Especial</h1>
    <a class="catalog-btn" href="https://drive.google.com/uc?export=view&id=1WYdfY_3xmnUY8qigKkjUOldoLjxUdRY0" target="_blank">游닀 Ver Cat치logo Completo</a>
  </header>
<div id="successBanner" 
     style="display:none;
            background:#28a745;
            color:white;
            padding:14px;
            border-radius:12px;
            text-align:center;
            font-size:20px;
            font-weight:bold;
            margin-bottom:15px;
            box-shadow:0 4px 10px rgba(0,0,0,0.15);">
  游꾻 Pedido Enviado com Sucesso! 游꾻
</div>

  <main>
    <div id="products">Carregando produtos...</div>

    <div class="summary">
      <h3>Seus dados</h3>
      <label>Nome
        <input id="customerName" type="text" placeholder="Seu nome">
      </label>
      <label>Telefone
        <input id="customerPhone" type="text" placeholder="(xx) xxxxx-xxxx">
      </label>
      <label>E-mail
        <input id="customerEmail" type="email" placeholder="seu@email.com">
      </label>

      <div class="total">Total: R$ <span id="totalValue">0.00</span></div>
      <div style="margin-top:12px">
        <button id="sendBtn" class="btn">游꾸 Enviar pedido 游꾸</button>
      </div>

      <div id="status" class="status"></div>
    </div>
  </main>
</div>

<script>
  // ---------- CONFIG: troque se necess치rio ----------
  const API_BASE = "https://script.google.com/macros/s/AKfycbxllLunPK0ioV4KvcU7GorgOC8Z0rD43DpMCRTlCDDNLcBOQZ9o11jIMUYFmp_8BdWz/exec";

  // placeholder image (data URI) usado se a imagem falhar
  const FALLBACK_IMG = "data:image/svg+xml;utf8," + encodeURIComponent(
    '<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300"><rect width="100%" height="100%" fill="#f5f5f5"/><text x="50%" y="50%" font-size="20" fill="#999" text-anchor="middle" alignment-baseline="middle">Imagem indispon칤vel</text></svg>'
  );

  let PRODUCTS = [];

  function qs(sel){ return document.querySelector(sel) }

function showStatus(msg, ok=true){
    const s = qs("#status");
    s.className = ok ? "status ok" : "status err";
    s.textContent = msg;
    s.style.display = "block";

    // NOVO: banner verde grande no topo
    if(ok){
        const banner = qs("#successBanner");
        banner.style.display = "block";
        setTimeout(() => { banner.style.display = "none"; }, 5000);
    }

    if(ok){
        setTimeout(() => s.style.display = "none", 3000);
    }
}

  async function fetchProducts(){
    try{
      const res = await fetch(API_BASE + "?op=getProducts");
      const json = await res.json();
      PRODUCTS = Array.isArray(json) ? json : [];
      renderProducts(PRODUCTS);
    }catch(err){
      console.error("Erro fetchProducts:", err);
      qs("#products").innerText = "Erro ao carregar produtos. Tente novamente.";
    }
  }

  function renderProducts(products){
    const box = qs("#products");
    box.innerHTML = "";
    if(!products || products.length===0){
      box.innerText = "Nenhum produto dispon칤vel.";
      return;
    }

    products.forEach((p, idx)=>{
      const div = document.createElement("div");
      div.className = "product";
      const img = document.createElement("img");
      img.src = p.image || FALLBACK_IMG;
      img.alt = p.name;
      img.onerror = ()=> { img.src = FALLBACK_IMG; };

      const info = document.createElement("div");
      info.className = "info";
      info.innerHTML = `<strong>${escapeHtml(p.name)}</strong><div class="price">R$ ${Number(p.price).toFixed(2)}</div>`;

      const input = document.createElement("input");
      input.type = "number";
      input.min = 0;
      input.value = 0;
      input.className = "qty";
      input.id = "q_" + idx;
      input.addEventListener("input", updateTotal);

      div.appendChild(img);
      div.appendChild(info);
      div.appendChild(input);
      box.appendChild(div);
    });

    updateTotal();
  }

  function updateTotal(){
    let t = 0;
    PRODUCTS.forEach((p, i)=>{
      const q = Number(qs("#q_"+i).value) || 0;
      t += q * Number(p.price || 0);
    });
    qs("#totalValue").innerText = t.toFixed(2);
  }

  function escapeHtml(s){
    if(!s) return "";
    return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  async function sendOrder(){
    const name = qs("#customerName").value.trim();
    const phone = qs("#customerPhone").value.trim();
    const email = qs("#customerEmail").value.trim();

    if(!name || !phone){
      alert("Preencha Nome e Telefone!");
      return;
    }

    const items = [];
    PRODUCTS.forEach((p, idx)=>{
      const q = Number(qs("#q_"+idx).value) || 0;
      if(q>0) items.push({ name: p.name, qty: q, price: Number(p.price) });
    });

    if(items.length === 0){
      alert("Escolha ao menos 1 produto.");
      return;
    }

    const total = items.reduce((s,i)=> s + i.qty*i.price, 0);
    const order = { customerName: name, customerPhone: phone, customerEmail: email, items, total };

    showStatus("Enviando pedido...", true);
    try{
      // Apps Script atual espera op=submitOrder & order=<JSON>
      const url = API_BASE + "?op=submitOrder&order=" + encodeURIComponent(JSON.stringify(order));
      const res = await fetch(url);
      const j = await res.json();
      if(j && j.status === "ok"){
        showStatus("Pedido enviado! ID: " + j.orderId, true);
        // limpar campos
        PRODUCTS.forEach((p, i)=> qs("#q_"+i).value = 0);
        qs("#customerName").value = "";
        qs("#customerPhone").value = "";
        qs("#customerEmail").value = "";
        updateTotal();
      } else {
        showStatus("Erro: " + (j && j.message ? j.message : "tente novamente"), false);
      }
    }catch(err){
      console.error("sendOrder erro:", err);
      showStatus("Erro de conex칚o. Verifique sua internet.", false);
    }
  }

  qs("#sendBtn").addEventListener("click", sendOrder);

  // carrega produtos ao abrir
  fetchProducts();
</script>
</body>
</html>




